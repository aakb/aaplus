{% extends 'AppBundle::base.html.twig' %}

{% block body -%}

  <div class="row heading">
    <div class="col-md-2">
      <h1>
        <nobr>{{ icon('file') }} {{ 'rapporter.labels.singular' | trans }}</nobr>
      </h1>
    </div>
    <div class="col-md-10 text-right">
      <a class="btn btn-default" href="{{ path('rapport_bilag_get', { 'rapport_id': entity.id }) }}">
        {{ icon('file') }} {{ 'bilag.actions.list' | trans }}
      </a>
      <a href="{{ path('rapport_show_pdf2', { 'id': entity.id }) }}" class="btn btn-default">
        {{ icon('file-pdf-o') }} {{ 'rapporter.actions.pdf2' | trans }}
      </a>
      <a href="{{ path('rapport_show_pdf5', { 'id': entity.id }) }}" class="btn btn-default">
        {{ icon('file-pdf-o') }} {{ 'rapporter.actions.pdf5' | trans }}
      </a>
      {% if is_granted('RAPPORT_EDIT', entity) %}
        <a class="btn btn-default" href="{{ path('energiforsyning', { 'rapport_id': entity.id }) }}">
          {{ icon('industry') }} Energiforsyninger
        </a>
        <a href="{{ path('rapport_edit', { 'id': entity.id }) }}" class="btn btn-default">
          {{ icon('edit') }} {{ 'rapporter.actions.edit' | trans }}
        </a>
      {% endif %}

      {% if prev_status_form is defined and is_granted('RAPPORT_EDIT', entity) %}
        {% form_theme prev_status_form 'AppBundle:Form:singleButtonConfirmModalForm.html.twig' %}
        {{ form( prev_status_form ) }}
      {% endif %}
      {% if next_status_form is defined and is_granted('RAPPORT_EDIT', entity) %}
        {% form_theme next_status_form 'AppBundle:Form:singleButtonConfirmModalForm.html.twig' %}
        {{ form( next_status_form ) }}
      {% endif %}

    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">{{ icon('home') }} {{ 'common.data' | trans }}</h3></div>

    <table class="table table-condensed">
      <tbody>
      <tr>
        <th>{{ 'appbundle.rapport.version' | trans }}</th>
        <td>{{ entity.fullVersion }}</td>
        <th>{{ 'appbundle.bygning.aaplusAnsvarlig' | trans }}</th>
        <td>{{ entity.bygning.aaplusAnsvarlig }}</td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.bygning' | trans }}</th>
        <td><a href="{{ path('bygning_show', { 'id': entity.bygning.id }) }}">{{ entity.bygning }}, {{ entity.bygning.adresse }}, {{ entity.bygning.postnummer }} {{ entity.bygning.postBy }}</a></td>
        <th>{{ 'appbundle.bygning.energiRaadgiver' | trans }}</th>
        <td>{{ entity.bygning.energiRaadgiver }}</td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.datering' | trans }}</th>
        <td>{{ entity.datering | date('Y-m-d') }}</td>
        <th>{{ 'appbundle.rapport.elena' | trans }}</th>
        <td>{{ entity.elena | b2icon }}</td>
      </tr>
      <tr>
        <th>{{ 'common.updatedat' | trans }}</th>
        <td>{{ entity.updatedAt | date('Y-m-d  H:i') }}, {{ entity.updatedBy }}</td>
        <th>{{ 'appbundle.bygning.status' | trans }}</th>
        <td>{{ entity.bygning.status | readable }}</td>
      </tr>
      </tbody>
    </table>

  </div>

  <div class="panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">{{ icon('balance-scale') }} {{ 'common.result_overview' | trans }}</h3></div>

    <table class="table table-condensed">
      <tbody>
      <tr>
        <th>{{ 'appbundle.rapport.energibesparelser' | trans }}:</th>
        <td></td>
        <td></td>
        <th>{{ 'appbundle.rapport.co2BesparelseFaktor' | trans }}:</th>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <th class="indent">{{ 'appbundle.rapport.besparelseEl' | trans }}</th>
        <td class="text-right">{{ entity.besparelseEl | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseEl.unit' | trans }}</td>

        <th class="indent">{{ 'appbundle.rapport.co2BesparelseSamletFaktor' | trans }}</th>
        <td class="text-right">{{ entity.co2BesparelseSamletFaktor | format_percent }}</td>
        <td></td>
      </tr>
      <tr>
        <th class="indent">{{ 'appbundle.rapport.besparelseVarmeGAF' | trans }}</th>
        <td class="text-right">{{ entity.besparelseVarmeGAF | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseVarmeGAF.unit' | trans }}</td>

        <th class="indent">{{ 'appbundle.rapport.co2BesparelseElFaktor' | trans }}</th>
        <td class="text-right">{{ entity.co2BesparelseElFaktor | format_percent }}</td>
        <td></td>
      </tr>
      <tr>
        <th class="indent">{{ 'appbundle.rapport.besparelseVarmeGUF' | trans }}</th>
        <td class="text-right">{{ entity.besparelseVarmeGUF | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseVarmeGUF.unit' | trans }}</td>

        <th class="indent">{{ 'appbundle.rapport.co2BesparelseVarmeFaktor' | trans }}</th>
        <td class="text-right">{{ entity.co2BesparelseVarmeFaktor | format_percent }}</td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <th>{{ 'appbundle.rapport.co2besparelser' | trans }}:</th>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>

        <th class="indent">{{ 'appbundle.rapport.besparelseCO2' | trans }}</th>
        <td class="text-right">{{ entity.besparelseCO2 | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseCO2.unit' | trans }}</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>

        <th class="indent">{{ 'appbundle.rapport.besparelseCO2el' | trans }}</th>
        <td class="text-right">{{ entity.co2BesparelseEl | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseCO2el.unit' | trans }}</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>

        <th class="indent">{{ 'appbundle.rapport.besparelseCO2varme' | trans }}</th>
        <td class="text-right">{{ entity.co2BesparelseVarme | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseCO2varme.unit' | trans }}</td>
      </tr>
      </tbody>
    </table>

  </div>

  <div class="panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">{{ icon('line-chart') }} {{ 'appbundle.rapport.likviditetsoversigt' | trans }}</h3></div>

    <div class="panel-body">
      {% include('AppBundle::_includes/finansiering_graf.html.twig') %}

      {% if is_granted('RAPPORT_EDIT', entity) and edit_form %}
        {% form_theme edit_form 'AppBundle:Form:aaplus-bootstrap.html.twig' %}
        {{ form(edit_form, { 'style': 'inline' }) }}
      {% else %}
        {{ 'appbundle.rapport.laanLoebetid' | trans }}:
        {{ entity.laanLoebetid }}Â {{ 'appbundle.rapport.laanLoebetid.unit' | trans }}
      {% endif %}

      {% include('AppBundle::_includes/finansiering_likviditetsoverblik.html.twig') %}
    </div>
  </div>

  {% if entity.tilvalgteTiltag is not empty %}
    {% include 'AppBundle::Rapport/_valgteTiltagTable.html.twig' with {'rapport': entity, 'tiltag': entity.tilvalgteTiltag, 'pdf': false, 'type': 'tilvalg', 'valgt_form_array': tilvalgt_form_array } %}
  {% endif %}


  {% if entity.fravalgteTiltag is not empty %}
    {% include 'AppBundle::Rapport/_valgteTiltagTable.html.twig' with {'rapport': entity, 'tiltag': entity.fravalgteTiltag, 'pdf': false, 'type': 'fravalg', 'valgt_form_array': fravalgt_form_array } %}
  {% endif %}

  <div class="panel panel-default">
    <div class="panel-heading"><h3 class="panel-title">{{ icon('dollar') }} {{ 'common.finans' | trans }}</h3></div>

    <table class="table table-condensed">
      <tbody>
      <tr>
        <th>{{ 'appbundle.rapport.faellesomkostninger' | trans }}:</th>
        <td></td>
        <td></td>
        <th>{{ 'appbundle.rapport.totalEntreprisesum' | trans }}</th>
        <td class="text-right">{{ entity.anlaegsinvestering | number_format }}</td>
        <td>{{ 'appbundle.rapport.totalEntreprisesum.unit' | trans }}</td>
      </tr>
      <tr>
        <td class="indent">{{ 'appbundle.rapport.energiscreening' | trans }}</td>
        <td class="text-right">{{ entity.energiscreening | number_format }}</td>
        <td>{{ 'appbundle.rapport.energiscreening.unit' | trans }}</td>
        <th>{{ 'appbundle.rapport.investeringEksFaellesomkostninger' | trans }}</th>
        <td class="text-right">{{ entity.investeringEksFaellesomkostninger | number_format }}</td>
        <td>{{ 'appbundle.rapport.investeringEksFaellesomkostninger.unit' | trans }}</td>
      </tr>
      <tr>
        <td class="indent">{{ 'appbundle.rapport.mtmFaellesomkostninger' | trans }}</td>
        <td class="text-right">{{ entity.mtmFaellesomkostninger | number_format }}</td>
        <td>{{ 'appbundle.rapport.mtmFaellesomkostninger.unit' | trans }}</td>
        <th>{{ 'appbundle.rapport.investeringInklFaellesomkostninger' | trans }}</th>
        <td class="text-right">{{ entity.investeringInklFaellesomkostninger | number_format }}</td>
        <td>{{ 'appbundle.rapport.investeringInklFaellesomkostninger.unit' | trans }}</td>
      </tr>
      <tr>
        <td class="indent">{{ 'appbundle.rapport.implementering' | trans }}</td>
        <td class="text-right">{{ entity.implementering | number_format }}</td>
        <td>{{ 'appbundle.rapport.implementering.unit' | trans }}</td>
        <th>{{ 'appbundle.rapport.nutidsvaerdiInklFaellesomkostninger' | trans }}</th>
        <td class="text-right">{{ entity.nutidsvaerdiSetOver15AarKr | number_format }}</td>
        <td>{{ 'appbundle.rapport.nutidsvaerdiInklFaellesomkostninger.unit' | trans }}</td>
      </tr>
      <tr>
        <th class="indent"></th>
        <td class="text-right"></td>
        <td></td>
        <th>{{ 'appbundle.rapport.besparelseAarEt' | trans }}</th>
        <td class="text-right">{{ entity.besparelseAarEt | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseAarEt.unit' | trans }}</td>
      </tr>
      <tr>
        <th class="indent"></th>
        <td class="text-right"></td>
        <td></td>
        <th>{{ 'appbundle.rapport.internRenteInklFaellesomkostninger' | trans }}</th>
        <td class="text-right">
          {% if entity.internRenteInklFaellesomkostninger < 100 %}
            {{ entity.internRenteInklFaellesomkostninger | number_format }}
          {% else %}
            --
          {% endif %}
        </td>
        <td>{{ 'appbundle.rapport.internRenteInklFaellesomkostninger.unit' | trans }}</td>
      </tr>
      <tr>
        <th></th>
        <td></td>
        <td></td>
        <th>{{ 'appbundle.rapport.genopretning' | trans }}</th>
        <td class="text-right">{{ entity.genopretning | number_format }}</td>
        <td>{{ 'appbundle.rapport.genopretning.unit' | trans }}</td>
      </tr>
      <tr>
        <th></th>
        <td></td>
        <td></td>
        <th>{{ 'appbundle.rapport.modernisering' | trans }}</th>
        <td class="text-right">{{ entity.modernisering | number_format }}</td>
        <td>{{ 'appbundle.rapport.modernisering.unit' | trans }}</td>
      </tr>
      </tbody>
    </table>

  </div>

  <div class="row heading">
    <div class="col-md-2"><h2>{{ 'tiltag.labels.singular' | trans }}</h2></div>
    <div class="col-md-10 text-right">
      {% if is_granted('RAPPORT_EDIT', entity) %}
        {% for type in [ 'pumpe', 'belysning', 'klimaskaerm', 'vindue', 'solcelle', 'tekniskisolering', 'special' ] %}
          <form method="POST" action="{{ path('tiltag_create', { 'id': entity.id, 'type': type }) }}" class="inline-block">
            <button type="submit" class="btn btn-default">{{ icon('plus') }} {{ ('rapporter.strings.' ~ type ~ 'tiltag') | trans }}</button>
          </form>
        {% endfor %}
      {% endif %}
    </div>
  </div>

  {% if entity.tiltag is not empty %}

    <div role="tabpanel">

      <!-- Nav tabs -->
      <ul class="nav nav-tabs" role="tablist">
        {% for key, t in entity.tiltag %}
          <li role="presentation" {% if key == 0 %} class="active" {% endif %}>
            <a href="#tiltag{{ key }}" aria-controls="home" role="tab" data-toggle="tab">
              {{ key + 1 }}. {{ t.title | slice(0, 15) }}{% if t.title | length > 15 %}...{% endif %}
            </a>
          </li>
        {% endfor %}
      </ul>

      <!-- Tab panes -->
      <div class="tab-content">
        {% for key, t in entity.tiltag %}
          <div role="tabpanel" class="tab-pane {% if key == 0 %}active{% endif %}" id="tiltag{{ key }}">
            <div class="row">
              <div class="col-md-6">
                <h3>{{ t.title }}</h3>
              </div>
              <div class="col-md-6 text-right">
                {% if is_granted('RAPPORT_EDIT', entity) %}
                  <a class="btn btn-default" href="{{ path('tiltag_bilag_get', { 'tiltag_id': t.id }) }}">
                    {{ icon('file') }} {{ 'bilag.actions.list' | trans }}
                  </a>
                  <a href="{{ path('tiltag_edit', { 'id': t.id }) }}" class="btn btn-default">
                    {{ icon('edit') }} {{ 'common.edit' | trans }}: {{ t.title | slice(0, 15) }}{% if t.title | length > 15 %}...{% endif %}
                  </a>
                {% endif %}
                <a href="{{ path('tiltag_show', { 'id': t.id }) }}" class="btn btn-default">
                  {{ icon('list') }} {{ 'rapporter.labels.detailark' | trans }}: {{ t.title | slice(0, 15) }}{% if t.title | length > 15 %}...{% endif %}
                </a>
              </div>
            </div>
            {{ include ('AppBundle:Tiltag:show-include.html.twig', {entity: t}, with_context = false) }}
          </div>
        {% endfor %}
      </div>

    </div>

  {% else %}

    <div class="alert alert-info" role="alert">{{ 'tiltag.strings.ingen' | trans }}</div>

  {% endif %}

{% endblock %}
