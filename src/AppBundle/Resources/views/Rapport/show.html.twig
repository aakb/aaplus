{% extends 'AppBundle::base.html.twig' %}

{% block body -%}

  <div class="row heading">
    <div class="col-md-8">
      <h1>{{ icon('file') }} {{ 'rapporter.labels.singular' | trans }}</h1>
    </div>
    <div class="col-md-4 right">
      <a href="{{ path('rapport_edit', { 'id': entity.id }) }}" class="btn btn-default">
        {{ icon('edit') }} {{ 'rapporter.actions.edit' | trans }}
      </a>
      <a class="btn btn-default" href="{{ path('energiforsyning', { 'rapport_id': entity.id }) }}">{{ icon('industry') }} Energiforsyninger</a>
    </div>
  </div>

  <div class="panel panel-default">
    <div class="panel-heading">{{ icon('home') }} {{ 'common.data' | trans }}</div>

    <table class="table table-condensed">
      <tbody>
      <tr>
        <th>{{ 'appbundle.rapport.version' | trans }}</th>
        <td>{{ entity.version }}</td>
        <th>{{ 'appbundle.bygning.aaplusAnsvarlig' | trans }}</th>
        <td>{{ entity.bygning.aaplusAnsvarlig }}</td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.bygning' | trans }}</th>
        <td><a href="{{ path('bygning_show', { 'id': entity.bygning.id }) }}">{{ entity.bygning }}, {{ entity.bygning.adresse }}, {{ entity.bygning.postnummer }} {{ entity.bygning.postBy }}</a></td>
        <th>{{ 'appbundle.bygning.energiRaadgiver' | trans }}</th>
        <td>{{ entity.bygning.energiRaadgiver }}</td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.datering' | trans }}</th>
        <td>{{ entity.datering | date('Y-m-d') }}</td>
        <th>{{ 'appbundle.rapport.elena' | trans }}</th>
        <td>{{ entity.elena | b2icon }}</td>
      </tr>
      <tr>
        <th>{{ 'common.updatedat' | trans }}</th>
        <td>{{ entity.updatedAt | date('Y-m-d  H:i') }}, {{ entity.updatedBy }}</td>
        <th></th>
        <td></td>
      </tr>
      </tbody>
    </table>

  </div>

  <div class="panel panel-default">
    <div class="panel-heading">{{ icon('balance-scale') }} {{ 'common.result_overview' | trans }}</div>

    <table class="table table-condensed">
      <tbody>
      <tr>
        <th>{{ 'appbundle.rapport.energibesparelser' | trans }}:</th>
        <td></td>
        <td></td>
        <th>{{ 'appbundle.rapport.co2besparelser' | trans }}:</th>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.besparelseEl' | trans }}</th>
        <td class="right">{{ entity.besparelseEl | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseEl.unit' | trans }}</td>
        <th>{{ 'appbundle.rapport.besparelseCO2' | trans }}</th>
        <td class="right">{{ entity.besparelseCO2 | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseCO2.unit' | trans }}</td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.besparelseVarmeGAF' | trans }}</th>
        <td class="right">{{ entity.besparelseVarmeGAF | number_format }}</td>
        <td>{{ 'appbundle.rapport.besparelseVarmeGAF.unit' | trans }}</td>
        <th>{{ 'appbundle.rapport.besparelseCO2el' | trans }}</th>
        <td>xx</td>
        <td>{{ 'appbundle.rapport.besparelseCO2el.unit' | trans }}</td>
      </tr>
      <tr>
        <th>{{ 'appbundle.rapport.besparelseVarmeGUF' | trans }}</th>
        <td class="right">{{ entity.besparelseVarmeGUF | number_format }} {{ 'appbundle.rapport.besparelseVarmeGUF.unit' | trans }}</td>
        <td>{{ 'appbundle.rapport.besparelseVarmeGUF.unit' | trans }}</td>
        <th>{{ 'appbundle.rapport.besparelseCO2varme' | trans }}</th>
        <td>xx</td>
        <td>{{ 'appbundle.rapport.besparelseCO2varme.unit' | trans }}</td>
      </tr>
      </tbody>
    </table>

  </div>

  <div class="panel panel-default">
    <div class="panel-heading">{{ icon('line-chart') }} {{ 'appbundle.rapport.likviditetsoversigt' | trans }}</div>

    <div class="panel-body">
      {% include('AppBundle::_includes/finansiering_graf.html.twig') %}

      {% if is_granted('ROLE_RAPPORT_EDIT') %}
        {% if edit_form %}
          {{ form(edit_form, { 'style': 'inline' }) }}
        {% endif %}
      {% else %}
        {{ 'appbundle.rapport.laanLoebetid' | trans }}: {{ entity.laanLoebetid }}
      {% endif %}

    </div>
  </div>

  {% if entity.tilvalgteTiltag is not empty %}

    <div class="panel panel-default">
      <div class="panel-heading">{{ icon('thumbs-up') }} {{ 'appbundle.rapport.tilvalg' | trans }}</div>

      <table class="table table-condensed">
        <thead>
        <tr>
          <th>{{ 'appbundle.tiltag.title' | trans }}</th>
          <th>{{ 'appbundle.tiltag.tilvalgtAfMagistrat' | trans }}</th>
          <th>{{ 'appbundle.tiltag.tilvalgtbegrundelse' | trans }}</th>
          <th class="right">{{ 'appbundle.tiltag.levetid' | trans }}</th>
          <th class="right">{{ 'appbundle.tiltag.simpelTilbagebetalingstidAar' | trans }}</th>
          <th class="right">{{ 'appbundle.tiltag.anlaegsInvestering' | trans }}</th>
          <th></th>
        </tr>
        </thead>
        <tbody>
        {% for t in entity.tilvalgteTiltag %}
          <tr>
            <td>{{ t.title }}</td>

            <td>{{ t.tilvalgtAfMagistrat | b2icon }}</td>
            <td>{{ t.tilvalgtbegrundelse }}</td>
            <td class="right">{{ t.levetid | number_format }} {{ 'appbundle.tiltag.levetid.unit' | trans }}</td>
            <td class="right">{{ t.simpelTilbagebetalingstidAar | number_format }} {{ 'appbundle.tiltag.simpelTilbagebetalingstidAar.unit' | trans }}</td>
            <td class="right">{{ t.anlaegsinvestering | number_format }} {{ 'appbundle.tiltag.anlaegsInvestering.unit' | trans }}</td>
            <td class="right">
              <button type="button" class="btn btn-default btn-xs" data-toggle="modal" data-target="#tilvalgtModal-{{ t.id }}">
                {{ 'common.deselect' | trans }}
              </button>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>

    </div>

    {% for t in entity.tilvalgteTiltag %}
      {% form_theme tilvalgt[t.id] 'AppBundle:Form:tilvalgt-modal-form.html.twig' %}
      {{ form(tilvalgt[t.id], { 'style': 'horizontal' }) }}
    {% endfor %}

  {% endif %}

  <!-- /////////////////////////////////////////////////// -->


  <hr>
  <hr>
  <hr>

  <div class="row heading">
    <div class="col-md-8">
      <h1>{{ icon('file') }} {{ 'rapporter.labels.singular' | trans }}</h1>
    </div>
    <div class="col-md-4 right">
      <a href="{{ path('rapport_edit', { 'id': entity.id }) }}" class="btn btn-default">
        {{ icon('edit') }} {{ 'rapporter.actions.edit' | trans }}
      </a>
      <a class="btn btn-default" href="{{ path('energiforsyning', { 'rapport_id': entity.id }) }}">{{ icon('industry') }} Energiforsyninger</a>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <table class="table table-condensed">
        <tbody>
        <tr>
          <th>{{ 'appbundle.rapport.version' | trans }}</th>
          <td>{{ entity.version }}</td>
        </tr>
        <tr>
          <th>{{ 'appbundle.rapport.bygning' | trans }}</th>
          <td>{{ entity.bygning }}</td>
        </tr>
        <tr>
          <th>{{ 'appbundle.rapport.datering' | trans }}</th>
          <td>{{ entity.datering | date('Y-m-d H:i:s') }}</td>
        </tr>
        <tr>
          <th>{{ 'appbundle.rapport.elena' | trans }}</th>
          <td>{{ entity.elena | b2icon }}</td>
        </tr>
        </tbody>
      </table>
    </div>
    <div class="col-md-6">
      <table class="table table-condensed">
        <tbody>
        <tr>
          <th>{{ 'appbundle.rapport.BaselineVarmeGUF' | trans }}</th>
          <td>{{ entity.BaselineVarmeGUF | format_decimal }}</td>
        </tr>
        <tr>
          <th>{{ 'appbundle.rapport.BaselineVarmeGAF' | trans }}</th>
          <td>{{ entity.BaselineVarmeGAF | format_decimal }}</td>
        </tr>
        <tr>
          <th>{{ 'appbundle.rapport.varmetotal' | trans }}</th>
          <td>{{ entity.totalvarme | format_decimal }}</td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>

  <h2>Tilvalgte tiltag</h2>

  {% if entity.tilvalgteTiltag is empty %}
    <div class="alert alert-info">Ingen tilvagte tiltag</div>
  {% else %}
    <table class="table table-condensed">
      <thead>
      <tr>
        <th>{{ 'appbundle.tiltag.title' | trans }}</th>
        <th>{{ 'appbundle.tiltag.varmebesparelseGUF' | trans }}</th>
        <th>{{ 'appbundle.tiltag.varmebesparelseGAF' | trans }}</th>
      </tr>
      </thead>
      <tbody>
      {% for t in entity.tilvalgteTiltag %}
        <tr>
          <td>{{ t.title }}</td>
          <td>{{ t.varmebesparelseGUF | format_decimal }}</td>
          <td>{{ t.varmebesparelseGAF | format_decimal }}</td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  {% endif %}

  <div class="row heading">
    <div class="col-md-2"><h2>{{ 'tiltag.labels.singular' | trans }}</h2></div>
    <div class="col-md-10 right">

      {% for type in [ 'pumpe', 'belysning', 'klimaskaerm', 'solcelle', 'tekniskisolering' ] %}
        {% if is_missing_tiltag_type(entity.tiltag, type) %}
          <form method="POST" action="{{ path('tiltag_create', { 'id': entity.id, 'type': type }) }}" class="inline-block">
            <button type="submit" class="btn btn-default">{{ icon('plus') }} {{ ('rapporter.strings.' ~ type ~ 'tiltag') | trans }}</button>
          </form>
        {% endif %}
      {% endfor %}

      <form method="POST" action="{{ path('tiltag_create', { 'id': entity.id, 'type': 'special' }) }}" class="inline-block">
        <button type="submit" class="btn btn-default">{{ icon('plus') }} {{ ('rapporter.strings.' ~ 'special' ~ 'tiltag') | trans }}</button>
      </form>
    </div>
  </div>

  <div role="tabpanel">

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" role="tablist">
      {% for key, t in entity.tiltag %}
        <li role="presentation" {% if key == 0 %} class="active" {% endif %}><a href="#tiltag{{ key }}" aria-controls="home" role="tab" data-toggle="tab">{{ key + 1 }}. {{ t.title }}</a></li>
      {% endfor %}
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
      {% for key, t in entity.tiltag %}
        <div role="tabpanel" class="tab-pane {% if key == 0 %}active{% endif %}" id="tiltag{{ key }}">
          <div class="row">
            <div class="col-md-6">
              <h3>{{ t.title }}</h3>
            </div>
            <div class="col-md-6 right">
              <a href="{{ path('tiltag_edit', { 'id': t.id }) }}" class="btn btn-default">
                {{ icon('edit') }} {{ 'common.edit' | trans }}: {{ t.title }}
              </a>
              <a href="{{ path('tiltag_show', { 'id': t.id }) }}" class="btn btn-default">
                {{ icon('list') }} {{ 'rapporter.labels.detailark' | trans }}: {{ t.title }}
              </a>
            </div>
          </div>
          {{ include ('AppBundle:Tiltag:show-include.html.twig', {entity: t}, with_context = false) }}
        </div>
      {% endfor %}
    </div>

  </div>

{% endblock %}
