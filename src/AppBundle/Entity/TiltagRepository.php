<?php
/**
 * @file
 * @TODO: Missing description.
 */

namespace AppBundle\Entity;

use Doctrine\ORM\EntityRepository;

/**
 * TiltagRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class TiltagRepository extends EntityRepository {
  /**
   * Create a new Tiltag based on type
   *
   * @param string $type
   * @return Tiltag
   */
  public function create($type) {
    $type = ucwords($type);
    $className = '\\AppBundle\\Entity\\' . $type .'Tiltag';

    if (!class_exists($className)) {
      throw new \InvalidArgumentException('Unknown tiltag type: '.$type);
    }

    $tiltag = new $className();

    switch ($type) {
      case 'Solcelle':
        $tiltag->setPrimaerEnterprise('ve');
        $tiltag->setTiltagskategori($this->getTiltagskategoriByName('Solceller'));
        break;
      case 'Tekniskisolering':
        $tiltag->setPrimaerEnterprise('vvs');
        $tiltag->setTiltagskategori($this->getTiltagskategoriByName('Varmeanlæg – generelt'));
        break;
      case 'Belysning':
        $tiltag->setPrimaerEnterprise('el');
        $tiltag->setTiltagskategori($this->getTiltagskategoriByName('Belysning'));
        break;
      case 'Klimaskaerm':
        $tiltag->setPrimaerEnterprise('t/i');
        $tiltag->setTiltagskategori($this->getTiltagskategoriByName('Klimaskærm'));
        break;
      case 'Pumpe':
        $tiltag->setPrimaerEnterprise('vvs');
        $tiltag->setTiltagskategori($this->getTiltagskategoriByName('Pumper'));
        break;
      case 'Vindue':
        $tiltag->setPrimaerEnterprise('Tømrer');
        $tiltag->setTiltagskategori($this->getTiltagskategoriByName('Vinduer'));
        break;
    }

    return $tiltag;
  }

  private function getTiltagskategoriByName($name) {
    return $this->_em->getRepository('AppBundle:Tiltagskategori')->findOneBy(array('navn' => $name));
  }

}
